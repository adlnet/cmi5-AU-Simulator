function getMatchHash(n){return n==="*"?n:'"'+n+'"'}function toBase64(n){return CryptoJS&&CryptoJS.enc.Base64?CryptoJS.enc.Base64.stringify(CryptoJS.enc.Latin1.parse(n)):Base64.encode(n)}function toSHA1(n){return CryptoJS&&CryptoJS.SHA1?CryptoJS.SHA1(n).toString():Crypto.util.bytesToHex(Crypto.SHA1(n,{asBytes:!0}))}function isDate(n){var t;return t=Object.prototype.toString.call(n)==="[object Date]"?n:new Date(n),Object.prototype.toString.call(t)==="[object Date]"?isNaN(t.valueOf())?(ADL.XAPIWrapper.log("Invalid date String passed"),null):t:(ADL.XAPIWrapper.log("Invalid date object"),null)}Date.prototype.toISOString||function(){function n(n){var t=String(n);return t.length===1&&(t="0"+t),t}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+n(this.getUTCMonth()+1)+"-"+n(this.getUTCDate())+"T"+n(this.getUTCHours())+":"+n(this.getUTCMinutes())+":"+n(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}(),function(n){function r(){try{return this.lrs.endpoint!=undefined&&this.lrs.endpoint!=""}catch(n){return!1}}function t(n){if(!t.debug)return!1;try{return console.log(n),!0}catch(i){return!1}}function i(n,r){for(var u in r){prop=r[u];t(u+" : "+prop);try{r[u].constructor==Object?n[u]=i(n[u],r[u]):(n==undefined&&(n={}),n[u]=r[u])}catch(f){n==undefined&&(n={});n[u]=r[u]}}return n}function f(n){var o=["endpoint","auth","actor","registration","activity_id","grouping","activity_platform"],r={},t,u,f;if(t=e(),t!==undefined&&Object.keys(t).length!==0){for(f=0;f<o.length;f++)u=o[f],t[u]&&(r[u]=t[u],delete t[u]);Object.keys(t).length!==0&&(r.extended=t);r=i(n,r)}else r=n;return r}function e(){var i,f,r,n,t,u;if(i=window.location.href.split("?"),i.length===2)for(f=i[1],r=f.split("&"),u={},t=0;t<r.length;t++)n=r[t].split("="),n.length===2&&n[0]&&(u[n[0]]=decodeURIComponent(n[1]));return u}function o(){var t=new XMLHttpRequest,i=window.location+"?forcenocache="+n.ruuid();t.open("GET",i,!1);t.send(null)}function h(n,t,i,r){var u=t,f=[],e=u.indexOf("?"),o;if(e>0&&(f.push(u.substr(e+1)),u=u.substr(0,e)),u=u+"?method="+n,i!==null)for(o in i)f.push(o+"="+encodeURIComponent(i[o]));return r!==null&&f.push("content="+encodeURIComponent(r)),{method:"POST",url:u,headers:{},data:f.join("&")}}t.debug=!1;var u=function(){var n={};n.endpoint="http://localhost:8000/xapi/";try{n.auth="Basic "+toBase64("tom:1234")}catch(i){t("Exception in Config trying to encode auth: "+i)}return n}();XAPIWrapper=function(t,u){function e(t){var i=document.createElement("a");if(i.href=t,i.protocol&&i.host)return i.protocol+"//"+i.host;n.XAPIWrapper.log("Couldn't create base url from endpoint: "+this.lrs.endpoint)}function o(n,t,i){n.auth="Basic "+toBase64(t+":"+i)}this.lrs=f(t||{});this.lrs.user&&this.lrs.password&&o(this.lrs,this.lrs.user,this.lrs.password);this.base=e(this.lrs.endpoint);u&&r.call(this)&&window.ADL.XHR_request(this.lrs,this.lrs.endpoint+"about","GET",null,null,function(t){var i,r,u;if(t.status==200)try{i=JSON.parse(t.response);r=!1;for(u in i.version)if(i.version[u]==n.XAPIWrapper.xapiVersion){r=!0;break}r||n.XAPIWrapper.log("The lrs version ["+i.version+"] does not match this wrapper's XAPI version ["+n.XAPIWrapper.xapiVersion+"]")}catch(f){n.XAPIWrapper.log("The response was not an about object")}else n.XAPIWrapper.log("The request to get information about the LRS failed: "+t)});this.searchParams=function(){return{format:"exact"}};this.hash=function(t){if(!t)return null;try{return toSHA1(t)}catch(i){return n.XAPIWrapper.log("Error trying to hash -- "+i),null}};this.changeConfig=function(t){try{n.XAPIWrapper.log("updating lrs object with new configuration");this.lrs=i(this.lrs,t);t.user&&t.password&&this.updateAuth(this.lrs,t.user,t.password);this.base=e(this.lrs.endpoint)}catch(r){n.XAPIWrapper.log("error while changing configuration -- "+r)}};this.updateAuth=o};XAPIWrapper.prototype.xapiVersion="1.0.1";XAPIWrapper.prototype.prepareStatement=function(n){n.actor===undefined?n.actor=JSON.parse(this.lrs.actor):typeof n.actor=="string"&&(n.actor=JSON.parse(n.actor));(this.lrs.grouping||this.lrs.registration||this.lrs.activity_platform)&&(n.context||(n.context={}));this.lrs.grouping&&(n.context.contextActivities||(n.context.contextActivities={}),n.context.contextActivities.grouping=[{id:this.lrs.grouping}]);this.lrs.registration&&(n.context.registration=this.lrs.registration);this.lrs.activity_platform&&(n.context.platform=this.lrs.activity_platform)};XAPIWrapper.prototype.testConfig=r;XAPIWrapper.prototype.log=t;XAPIWrapper.prototype.sendStatement=function(t,i){var r,u;if(this.testConfig()&&(this.prepareStatement(t),t.id?r=t.id:(r=n.ruuid(),t.id=r),u=n.XHR_request(this.lrs,this.lrs.endpoint+"statements","POST",JSON.stringify(t),this.lrs.auth,i,{id:r}),!i))return{xhr:u,id:r}};XAPIWrapper.prototype.sendStatements=function(t,i){var r,u;if(this.testConfig()){for(r in t)this.prepareStatement(t[r]);if(u=n.XHR_request(this.lrs,this.lrs.endpoint+"statements","POST",JSON.stringify(t),this.lrs.auth,i),!i)return u}};XAPIWrapper.prototype.getStatements=function(t,i,r){var u,f,o,e;if(this.testConfig()){if(u=this.lrs.endpoint+"statements",i)u=this.base+i;else{f=[];for(s in t)s=="until"||s=="since"?(o=new Date(t[s]),f.push(s+"="+encodeURIComponent(o.toISOString()))):f.push(s+"="+encodeURIComponent(t[s]));f.length>0&&(u=u+"?"+f.join("&"))}if(e=n.XHR_request(this.lrs,u,"GET",null,this.lrs.auth,r),e===undefined||e.status==404)return null;try{return JSON.parse(e.response)}catch(h){return e.response}}};XAPIWrapper.prototype.getActivities=function(t,i){var u,r;if(this.testConfig()){if(u=this.lrs.endpoint+"activities?activityId=<activityid>",u=u.replace("<activityid>",encodeURIComponent(t)),r=n.XHR_request(this.lrs,u,"GET",null,this.lrs.auth,i,null,!0),r===undefined||r.status==404)return null;try{return JSON.parse(r.response)}catch(f){return r.response}}};XAPIWrapper.prototype.sendState=function(i,r,u,f,e,o,s,h){var l,c,a;if(this.testConfig()){if(l=this.lrs.endpoint+"activities/state?activityId=<activity ID>&agent=<agent>&stateId=<stateid>",l=l.replace("<activity ID>",encodeURIComponent(i)),l=l.replace("<agent>",encodeURIComponent(JSON.stringify(r))),l=l.replace("<stateid>",encodeURIComponent(u)),f&&(l+="&registration="+encodeURIComponent(f)),c=null,o&&s?t("Can't have both If-Match and If-None-Match"):o?c={"If-Match":getMashHash(mashHash)}:s&&(c={"If-None-Match":getMashHash(s)}),a="PUT",e)e instanceof Array?(e=JSON.stringify(e),c=c||{},c["Content-Type"]="application/json"):e instanceof Object?(e=JSON.stringify(e),c=c||{},c["Content-Type"]="application/json",a="POST"):(c=c||{},c["Content-Type"]="application/octet-stream");else return this.log("No activity state was included."),!1;n.XHR_request(this.lrs,l,a,e,this.lrs.auth,h,null,null,c)}};XAPIWrapper.prototype.getState=function(t,i,r,u,f,e){var o,s;if(this.testConfig()){if(o=this.lrs.endpoint+"activities/state?activityId=<activity ID>&agent=<agent>",o=o.replace("<activity ID>",encodeURIComponent(t)),o=o.replace("<agent>",encodeURIComponent(JSON.stringify(i))),r&&(o+="&stateId="+encodeURIComponent(r)),u&&(o+="&registration="+encodeURIComponent(u)),f&&(f=isDate(f),f!=null&&(o+="&since="+encodeURIComponent(f.toISOString()))),s=n.XHR_request(this.lrs,o,"GET",null,this.lrs.auth,e,null,!0),s===undefined||s.status==404)return null;try{return JSON.parse(s.response)}catch(h){return s.response}}};XAPIWrapper.prototype.deleteState=function(i,r,u,f,e,o,s){var h,l,c;if(this.testConfig()){if(h=this.lrs.endpoint+"activities/state?activityId=<activity ID>&agent=<agent>&stateId=<stateid>",h=h.replace("<activity ID>",encodeURIComponent(i)),h=h.replace("<agent>",encodeURIComponent(JSON.stringify(r))),h=h.replace("<stateid>",encodeURIComponent(u)),f&&(h+="&registration="+encodeURIComponent(f)),l=null,e&&o?t("Can't have both If-Match and If-None-Match"):e?l={"If-Match":getMashHash(e)}:o&&(l={"If-None-Match":getMashHash(o)}),c=n.XHR_request(this.lrs,h,"DELETE",null,this.lrs.auth,s,null,l),c===undefined||c.status==404)return null;try{return JSON.parse(c.response)}catch(a){return c}}};XAPIWrapper.prototype.sendActivityProfile=function(i,r,u,f,e,o){var h,s,c;if(this.testConfig()){if(h=this.lrs.endpoint+"activities/profile?activityId=<activity ID>&profileId=<profileid>",h=h.replace("<activity ID>",encodeURIComponent(i)),h=h.replace("<profileid>",encodeURIComponent(r)),s=null,f&&e?t("Can't have both If-Match and If-None-Match"):f?s={"If-Match":getMashHash(f)}:e&&(s={"If-None-Match":getMashHash(e)}),c="PUT",u)u instanceof Array?(u=JSON.stringify(u),s=s||{},s["Content-Type"]="application/json"):u instanceof Object?(u=JSON.stringify(u),s=s||{},s["Content-Type"]="application/json",c="POST"):(s=s||{},s["Content-Type"]="application/octet-stream");else return this.log("No activity profile was included."),!1;n.XHR_request(this.lrs,h,c,u,this.lrs.auth,o,null,!1,s)}};XAPIWrapper.prototype.getActivityProfile=function(t,i,r,u){var f,e;if(this.testConfig()){if(f=this.lrs.endpoint+"activities/profile?activityId=<activity ID>",f=f.replace("<activity ID>",encodeURIComponent(t)),i&&(f+="&profileId="+encodeURIComponent(i)),r&&(r=isDate(r),r!=null&&(f+="&since="+encodeURIComponent(r.toISOString()))),e=n.XHR_request(this.lrs,f,"GET",null,this.lrs.auth,u,null,!0),e===undefined||e.status==404)return null;try{return JSON.parse(e.response)}catch(o){return e.response}}};XAPIWrapper.prototype.deleteActivityProfile=function(i,r,u,f,e){var o,h,s;if(this.testConfig()){if(o=this.lrs.endpoint+"activities/profile?activityId=<activity ID>&profileId=<profileid>",o=o.replace("<activity ID>",encodeURIComponent(i)),o=o.replace("<profileid>",encodeURIComponent(r)),h=null,u&&f?t("Can't have both If-Match and If-None-Match"):u?h={"If-Match":getMashHash(u)}:f&&(h={"If-None-Match":getMashHash(f)}),s=n.XHR_request(this.lrs,o,"DELETE",null,this.lrs.auth,e,null,h),s===undefined||s.status==404)return null;try{return JSON.parse(s.response)}catch(c){return s}}};XAPIWrapper.prototype.getAgents=function(t,i){var u,r;if(this.testConfig()){if(u=this.lrs.endpoint+"agents?agent=<agent>",u=u.replace("<agent>",encodeURIComponent(JSON.stringify(t))),r=n.XHR_request(this.lrs,u,"GET",null,this.lrs.auth,i,null,!0),r===undefined||r.status==404)return null;try{return JSON.parse(r.response)}catch(f){return r.response}}};XAPIWrapper.prototype.sendAgentProfile=function(i,r,u,f,e,o){var h,s,c;if(this.testConfig()){if(h=this.lrs.endpoint+"agents/profile?agent=<agent>&profileId=<profileid>",h=h.replace("<agent>",encodeURIComponent(JSON.stringify(i))),h=h.replace("<profileid>",encodeURIComponent(r)),s=null,f&&e?t("Can't have both If-Match and If-None-Match"):f?s={"If-Match":getMashHash(f)}:e&&(s={"If-None-Match":getMashHash(e)}),c="PUT",u)u instanceof Array?(u=JSON.stringify(u),s=s||{},s["Content-Type"]="application/json"):u instanceof Object?(u=JSON.stringify(u),s=s||{},s["Content-Type"]="application/json",c="POST"):(s=s||{},s["Content-Type"]="application/octet-stream");else return this.log("No agent profile was included."),!1;n.XHR_request(this.lrs,h,c,u,this.lrs.auth,o,null,!1,s)}};XAPIWrapper.prototype.getAgentProfile=function(t,i,r,u){var f,e;if(this.testConfig()){if(f=this.lrs.endpoint+"agents/profile?agent=<agent>",f=f.replace("<agent>",encodeURIComponent(JSON.stringify(t))),f=f.replace("<profileid>",encodeURIComponent(i)),i&&(f+="&profileId="+encodeURIComponent(i)),r&&(r=isDate(r),r!=null&&(f+="&since="+encodeURIComponent(r.toISOString()))),e=n.XHR_request(this.lrs,f,"GET",null,this.lrs.auth,u,null,!0),e===undefined||e.status==404)return null;try{return JSON.parse(e.response)}catch(o){return e.response}}};XAPIWrapper.prototype.deleteAgentProfile=function(i,r,u,f,e){var o,h,s;if(this.testConfig()){if(o=this.lrs.endpoint+"agents/profile?agent=<agent>&profileId=<profileid>",o=o.replace("<agent>",encodeURIComponent(JSON.stringify(i))),o=o.replace("<profileid>",encodeURIComponent(r)),h=null,u&&f?t("Can't have both If-Match and If-None-Match"):u?u=="*"&&(h={"If-Match":getMashHash(u)}):f&&(h={"If-None-Match":getMashHash(f)}),s=n.XHR_request(this.lrs,o,"DELETE",null,this.lrs.auth,e,null,h),s===undefined||s.status==404)return null;try{return JSON.parse(s.response)}catch(c){return s}}};
/*!
    Excerpt from: Math.uuid.js (v1.4)
    http://www.broofa.com
    mailto:robert@broofa.com
    Copyright (c) 2010 Robert Kieffer
    Dual licensed under the MIT and GPL licenses.
    */
n.ruuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)})};n.dateFromISOString=function(n){var t=n.match(new RegExp("([0-9]{4})(-([0-9]{2})(-([0-9]{2})([T| ]([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?")),r=0,i=new Date(t[1],0,1),u;return t[3]&&i.setMonth(t[3]-1),t[5]&&i.setDate(t[5]),t[7]&&i.setHours(t[7]),t[8]&&i.setMinutes(t[8]),t[10]&&i.setSeconds(t[10]),t[12]&&i.setMilliseconds(Number("0."+t[12])*1e3),t[14]&&(r=(Number(t[16])*60+Number(t[17]))*(t[15]=="-"?1:-1)),r-=i.getTimezoneOffset(),time=Number(i)+r*6e4,u=new Date,u.setTime(Number(time)),u};n.XHR_request=function(t,i,r,u,f,e,s,c,l){"use strict";function k(){var u,f,t;if(d)return tt;if(d=!0,u=c&&a.status===404,a.status===undefined||a.status>=200&&a.status<400||u)if(e)if(s)e(a,s);else try{f=JSON.parse(a.responseText);e(a,f)}catch(h){e(a,a.responseText)}else return tt=a,a;else{try{t="There was a problem communicating with the Learning Record Store. ( "+a.status+" | "+a.response+" )"+i}catch(o){t=o.toString()}return n.XAPIWrapper.log(t),n.xhrRequestOnError(a,r,i,e,s),tt=a,a}}var a,d=!1,w=!1,g=!1,b,p=i.toLowerCase().match(/^(.+):\/\/([^:\/]*):?(\d+)?(\/.*)?$/),nt=window.location,rt,tt,ut,v={},it,y;if(v["Content-Type"]="application/json",v.Authorization=f,v["X-Experience-API-Version"]=n.XAPIWrapper.xapiVersion,l!==null)for(y in l)v[y]=l[y];if(w=nt.protocol.toLowerCase()!==p[1]||nt.hostname.toLowerCase()!==p[2],w||(rt=p[3]===null?p[1]==="http"?"80":"443":p[3],w=rt===nt.port),it=window.XDomainRequest&&window.XMLHttpRequest&&(new XMLHttpRequest).responseType===undefined,w&&it!==undefined&&it!==!1)g=!0,b=h(r,i,v,u),a=new XDomainRequest,a.open(b.method,b.url);else{a=new XMLHttpRequest;a.open(r,i,e!=null);for(y in v)a.setRequestHeader(y,v[y])}if(a.onreadystatechange=function(){if(a.readyState===4)return k()},a.onload=k,a.onerror=k,a.send(g?b.data:u),!e){if(g)for(ut=1e3+new Date;new Date<ut&&a.readyState!==4&&!d;)o();return k()}};n.xhrRequestOnError=function(){};n.XAPIWrapper=new XAPIWrapper(u,!1)}(window.ADL=window.ADL||{});