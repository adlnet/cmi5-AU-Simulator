function GetAgentProfile(){var t={endpoint:endPoint,auth:"Basic "+window.btoa(jq("#txtAuthToken").val()+":CMI5")},n;return ADL.XAPIWrapper.changeConfig(t),n=ADL.XAPIWrapper.getAgentProfile(jq.parseJSON(actor),"cmi5LearnerPreferences",null),jq("#txtProfile").val(JSON.stringify(n)),MarkSuccess("btnProfile"),MarkNext("btnStatement"),!1}function GetAuthToken(){return jq.support.cors=!0,jq.ajax({async:!1,url:fetchUrl,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(n){var t=typeof n["error-code"];if(t=="string"){alert("error-code "+n["error-code"]+": "+n["error-text"]);return}t=typeof n["auth-token"];t=="string"?(jq("#txtAuthToken").val(n["auth-token"]),MarkSuccess("btnAuthToken"),MarkNext("btnState"),GetAUName()):alert("Invalid structure returned: "+n.toString())}).fail(function(n,t,i){alert(i)}),!1}function GetAUName(){var t,n;return jq.support.cors=!0,t={endpoint:endPoint,auth:"Basic "+window.btoa(jq("#txtAuthToken").val()+":CMI5")},ADL.XAPIWrapper.changeConfig(t),n=ADL.XAPIWrapper.searchParams(),n.verb="http://adlnet.gov/expapi/verbs/launched",n.activity=activityId,n.registration=registration,n.limit="1",ADL.XAPIWrapper.getStatements(n,null,function(n){var i=$.parseJSON(n.response),r,t,u;i.hasOwnProperty("statements")?(t=i.statements,u=t.length):(r=i,u=1);u>0&&(t=r?$.parseJSON("["+JSON.stringify(r)+"]"):$.parseJSON(JSON.stringify(t)),jq("#AUTitle").html("- "+t[0].object.definition.name["en-US"]),auName=t[0].object.definition.name)}),!1}function GetStateApi(){return jq.support.cors=!0,jq.ajax({async:!0,url:"Handlers/Getcmi5StateDocument.ashx?endpoint="+endPoint+"&activityId="+activityId+"&actor="+actor+"&registration="+registration+"&token="+jq("#txtAuthToken").val(),type:"POST",dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(n){var t,i;if(n.ErrorCode!="0")return alert("error-code "+n.ErrorCode+": "+n.ErrorText),!1;t=JSON.parse(n.StateDocument);sessionId=t.contextTemplate.extensions["https://w3id.org/xapi/cmi5/context/extensions/sessionid"];contextActivities=t.contextTemplate.contextActivities;i=typeof t.returnURL;i=="string"&&(returnUrl=t.returnURL);masteryScore=t.masteryScore;jq("#spnMasteryScore").html("Mastery = "+masteryScore.toString());jq("#txtState").val(JSON.stringify(t,null,4));MarkSuccess("btnState");MarkNext("btnProfile")}).fail(function(n,t,i){alert(i)}),!1}function GoLMS(){return typeof returnUrl=="string"&&returnUrl.length>0?(document.location.href=returnUrl,!1):(self.close(),!1)}function MarkNext(n){jq("#"+n).removeClass("btn-success btn-default").addClass("btn-primary")}function MarkSuccess(n){jq("#"+n).removeClass("btn-primary btn-default").addClass("btn-success")}function SendStatement(){var n=jq("input:radio[name='rdoVerb']:checked").val(),t=jq("#txtScore").val(),i=jq("input:radio[name='rdoSuccess']:checked").val(),r=jq("input:radio[name='rdoComplete']:checked").val(),u=jq("#durationHours").val()+":"+jq("#durationMinutes").val()+":"+jq("#durationSeconds").val(),f=jq("#input_progress").val();return jq.ajax({async:!0,url:"Handlers/Sendcmi5Statement.ashx?endpoint="+endPoint+"&activityId="+activityId+"&actor="+actor+"&registration="+registration+"&token="+jq("#txtAuthToken").val()+"&sessionId="+sessionId+"&score="+t+"&masteryScore="+masteryScore+"&verb="+n+"&success="+i+"&complete="+r+"&duration="+u+"&contextActivities="+JSON.stringify(contextActivities)+"&progress="+f+"&auName="+JSON.stringify(auName),type:"POST",contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(t){if(t.HasError==1){alert(t.ErrorMessage);return}n=="Terminated"&&(MarkSuccess("btnStatement"),MarkNext("btnLMS"));jq("#spnVerbsSent").append(n+"<br/>")}).fail(function(n,t,i){alert(i)}),!1}function parse(n){var i="Not found",t=[];return n=n.toUpperCase(),location.search.substr(1).split("&").forEach(function(r){t=r.split("=");t[0].toUpperCase()===n&&(i=decodeURIComponent(t[1]))}),i}var jq=$;jq(function(){endPoint=parse("endpoint");fetchUrl=parse("fetch");registration=parse("registration");activityId=parse("activityid");actor=parse("actor");jq("input:radio[name='rdoVerb']").change(function(){var n=jq(this).val();n=="Initialized"&&(jq("input:radio[name='rdoComplete'][value='']").prop("checked",!0),jq("input:radio[name='rdoSuccess'][value='']").prop("checked",!0));n=="Completed"&&(jq("input:radio[name='rdoComplete'][value='true']").prop("checked",!0),jq("input:radio[name='rdoSuccess'][value='']").prop("checked",!0));n=="Passed"&&(jq("input:radio[name='rdoComplete'][value='']").prop("checked",!0),jq("input:radio[name='rdoSuccess'][value='true']").prop("checked",!0));n=="Failed"&&(jq("input:radio[name='rdoSuccess'][value='false']").prop("checked",!0),jq("input:radio[name='rdoComplete'][value='false']").prop("checked",!0));n=="Terminated"&&jq("#durationMinutes").val("1")})});